# インデックスを設定できる

## 1. インデックス設定前

employees データベースの employees テーブルに対して、誕生日が1961年8月3日のレコードを取得してください。その際に、EXPLAIN ANALYZE ステートメントを利用することで、実行時間を計測してください。

select * from employees where birth_date = '1961-08-03';
67 rows in set (0.10 sec)

| -> Filter: (employees.birth_date = DATE'1961-08-03')  (cost=30157 rows=29925) (actual time=9.44..134 rows=67 loops=1)
    -> Table scan on employees  (cost=30157 rows=299246) (actual time=0.143..120 rows=300024 loops=1)show

## 2. インデックスの作成

employees データベースの employees テーブルの birth_date カラムにインデックスを作成してください。

CREATE INDEX birth_index
ON employees (birth_date);

## 3. インデックスの確認

employees データベースの employees テーブルのインデックスを確認し、インデックスが作成されていることを確認してください。

+------------+---------------+------+-----+---------+-------+
| Field      | Type          | Null | Key | Default | Extra |
+------------+---------------+------+-----+---------+-------+
| emp_no     | int           | NO   | PRI | NULL    |       |
| birth_date | date          | NO   | MUL | NULL    |       |
| first_name | varchar(14)   | NO   |     | NULL    |       |
| last_name  | varchar(16)   | NO   |     | NULL    |       |
| gender     | enum('M','F') | NO   |     | NULL    |       |
| hire_date  | date          | NO   |     | NULL    |       |
+------------+---------------+------+-----+---------+-------+
6 rows in set (0.01 sec)

## 4. インデックスの効果の確認

1と同じクエリを実行してください。その際に、EXPLAIN ANALYZE ステートメントを利用することで、実行時間を計測し、実行が高速化されていることを確認してください。

+-----------------------------------------------------------------------------------------------------------------------------------------------+
| EXPLAIN                                                                                                                                       |
+-----------------------------------------------------------------------------------------------------------------------------------------------+
| -> Index lookup on employees using birth_index (birth_date=DATE'1961-08-03')  (cost=40.6 rows=67) (actual time=0.226..0.237 rows=67 loops=1)
 |
+-----------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

## 5. インデックスの説明

インデックスを貼ることでクエリが高速化された理由をデータベース初心者にわかるように説明してください。
今まで1から最後までスキャンしていた計算量O(N)サーチがカラムにインデックスを貼ることでツリー構造にデータがラベリングされ、それを元に二分探索されることで計算量をO(log(N))になった為。

## 6. インデックスの削除

作成したインデックスを削除してください。

## 7. ベストプラクティス

インデックスは作成すればするほどよいというものではありません。必要な場合のみ作成することが重要です。

インデックス作成のベストプラクティスについて調べ、どのような方針でインデックスを貼ると良いかまとめてください。


・サイズの大きいテーブルである
・一意制約がある列に不用（既にindexがある）
・カーディナルの高い列（バラバラ度が高いもの）
・WHERE JOIN ORDER BYが頻繁に使われる列に貼る